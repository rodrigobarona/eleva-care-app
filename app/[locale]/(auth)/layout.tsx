import { auth } from '@clerk/nextjs/server';
import Image from 'next/image';
import Link from 'next/link';
import { redirect } from 'next/navigation';
import type { ReactNode } from 'react';

export const dynamic = 'force-dynamic';

// Inline the logo SVG for better performance
const ElevaCareLogo = ({ className }: { className?: string }) => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="1801"
    height="357"
    fill="currentColor"
    aria-label="ElevaCare Logo"
    role="img"
    className={className}
  >
    <path d="M0 179c0 87.128 70.872 158 158 158s158-70.872 158-158S245.128 21 158 21 0 91.872 0 179Zm9.888 0C9.888 97.36 76.308 30.94 158 30.94c21.223 0 41.422 4.485 59.693 12.559-79.745 127.005-111.329 224.119-123.906 268.957C44.179 288.489 9.888 237.66 9.888 179Zm109.973 143.135C134.784 241.19 210.45 79.544 225.756 47.357 273.431 71.973 306.112 121.72 306.112 179c0 81.692-66.42 148.112-148.112 148.112a147.835 147.835 0 0 1-38.139-4.977Zm5.576-128.07s-58.758-20.967-65.488-93.185c0 0 57.05 13.46 65.488 93.185Zm146.507 17.705c-54.565 47.731-111.666 22.519-111.666 22.519 59.898-51.151 109.808-23.546 111.615-22.546l.051.027Zm-75.479-73.875s36.445 16.1 71.286-14.392c0 0-32.356-18.896-71.286 14.392ZM133.72 50.509c3.779 38.671 34.944 49.75 34.944 49.75-4.628-41.957-33.936-49.49-34.919-49.743l-.025-.007Zm54.461 225.093c0 10.264-8.32 18.585-18.585 18.585-10.264 0-18.585-8.321-18.585-18.585 0-10.265 8.321-18.586 18.585-18.586 10.265 0 18.585 8.321 18.585 18.586Zm-75.531-60.415c0 10.264-8.321 18.585-18.585 18.585-10.265 0-18.585-8.321-18.585-18.585 0-10.265 8.321-18.585 18.585-18.585 10.264 0 18.585 8.32 18.585 18.585ZM414.058 78.9h139.175v20.51H437.498v70.32h103.429v20.217H437.498v73.836h119.544V284H414.058V78.9Zm180.303-12.306h22.854V284h-22.854V66.594Zm183.518 131.264c-.39-10.353-2.832-19.24-7.325-26.663-4.297-7.618-10.255-13.478-17.873-17.58-7.422-4.102-16.212-6.153-26.37-6.153-10.743 0-20.217 2.442-28.421 7.325-8.008 4.883-14.357 11.72-19.045 20.51-4.688 8.79-7.032 19.045-7.032 30.765 0 12.111 2.344 22.756 7.032 31.937 4.884 8.985 11.623 16.017 20.217 21.096 8.595 5.079 18.362 7.618 29.3 7.618 19.534 0 35.453-6.641 47.759-19.924l12.599 12.599c-7.422 8.009-16.408 14.259-26.956 18.752-10.548 4.297-22.17 6.446-34.867 6.446-15.236 0-28.714-3.223-40.434-9.669-11.524-6.641-20.51-15.822-26.956-27.542-6.446-11.72-9.669-25.198-9.669-40.434 0-15.236 3.223-28.616 9.669-40.141 6.446-11.72 15.432-20.803 26.956-27.249 11.72-6.641 25.003-10.06 39.848-10.255 16.604 0 30.375 3.614 41.313 10.841 10.939 7.032 18.948 16.994 24.026 29.886 5.274 12.697 7.423 27.64 6.446 44.829H667.711v-16.994h110.168Zm19.716-67.976h24.026l49.224 132.436 48.931-132.436h23.147L882.272 284h-23.733l-60.944-154.118Zm207.255 81.747c-12.893 0-22.66 2.149-29.301 6.446-6.641 4.297-9.962 10.841-9.962 19.631 0 8.79 3.125 15.92 9.376 21.389 6.446 5.274 15.138 7.911 26.077 7.911 8.99 0 17.09-1.465 24.32-4.395 7.23-2.93 13.18-7.13 17.87-12.599 4.89-5.469 8.21-12.111 9.96-19.924l5.86 18.459c-5.47 12.306-13.57 21.487-24.31 27.542-10.75 5.86-23.44 8.79-38.095 8.79-10.548 0-19.826-2.051-27.835-6.153-7.813-4.102-13.869-9.669-18.166-16.701-4.297-7.032-6.446-14.943-6.446-23.733 0-13.283 5.079-23.831 15.236-31.644 10.157-7.813 24.319-11.818 42.486-12.013h54.79v16.994h-51.86Zm47.76-27.249c0-11.72-3.52-20.803-10.55-27.249-6.84-6.446-17.09-9.669-30.76-9.669-8.6 0-16.901 1.563-24.91 4.688s-16.017 7.52-24.026 13.185l-9.669-14.943c6.641-4.493 13.087-8.302 19.338-11.427 6.251-3.125 12.892-5.469 19.924-7.032 7.032-1.758 14.943-2.637 23.733-2.637 19.14 0 33.79 4.786 43.95 14.357 10.16 9.376 15.33 22.268 15.53 38.676l.29 101.671h-22.27l-.58-99.62Zm279.32-61.53c-7.81-8.009-17.09-14.259-27.84-18.752-10.54-4.688-21.48-7.032-32.81-7.032-11.53 0-22.37 2.149-32.53 6.446-10.15 4.297-19.04 10.353-26.66 18.166-7.62 7.618-13.57 16.506-17.87 26.663-4.3 10.157-6.45 21.096-6.45 32.816 0 11.525 2.15 22.366 6.45 32.523 4.3 10.157 10.25 19.045 17.87 26.663 7.62 7.618 16.51 13.673 26.66 18.166 10.16 4.297 21 6.446 32.53 6.446 11.33 0 22.17-2.149 32.52-6.446 10.55-4.493 19.92-10.646 28.13-18.459l14.36 14.65c-6.65 6.251-14.17 11.72-22.57 16.408-8.2 4.688-16.79 8.302-25.78 10.841-8.98 2.539-18.26 3.809-27.83 3.809-14.85 0-28.72-2.637-41.61-7.911-12.7-5.469-23.93-12.99-33.7-22.561-9.57-9.571-17.09-20.705-22.56-33.402-5.47-12.697-8.2-26.272-8.2-40.727 0-14.455 2.73-27.933 8.2-40.434 5.47-12.501 13.09-23.538 22.86-33.109 9.76-9.571 21.09-16.994 33.99-22.268 12.89-5.274 26.85-7.911 41.89-7.911 9.38 0 18.56 1.172 27.55 3.516 8.98 2.344 17.48 5.762 25.49 10.255a102.853 102.853 0 0 1 21.97 15.822l-14.06 15.822Zm92.06 88.779c-12.89 0-22.66 2.149-29.3 6.446-6.64 4.297-9.96 10.841-9.96 19.631 0 8.79 3.12 15.92 9.37 21.389 6.45 5.274 15.14 7.911 26.08 7.911 8.98 0 17.09-1.465 24.32-4.395 7.23-2.93 13.18-7.13 17.87-12.599 4.88-5.469 8.2-12.111 9.96-19.924l5.86 18.459c-5.47 12.306-13.57 21.487-24.32 27.542-10.74 5.86-23.44 8.79-38.09 8.79-10.54 0-19.82-2.051-27.83-6.153-7.81-4.102-13.87-9.669-18.17-16.701-4.29-7.032-6.44-14.943-6.44-23.733 0-13.283 5.08-23.831 15.23-31.644 10.16-7.813 24.32-11.818 42.49-12.013h54.79v16.994h-51.86Zm47.76-27.249c0-11.72-3.52-20.803-10.55-27.249-6.84-6.446-17.09-9.669-30.77-9.669-8.59 0-16.89 1.563-24.9 4.688-8.01 3.125-16.02 7.52-24.03 13.185l-9.67-14.943c6.65-4.493 13.09-8.302 19.34-11.427s12.89-5.469 19.93-7.032c7.03-1.758 14.94-2.637 23.73-2.637 19.14 0 33.79 4.786 43.95 14.357 10.16 9.376 15.33 22.268 15.53 38.676L1494.6 284h-22.27l-.58-99.62Zm143.32-34.281c-11.53-.195-21.49 2.246-29.89 7.325-8.2 4.883-14.55 11.818-19.04 20.803-4.5 8.79-6.74 19.143-6.74 31.058l-7.91-.879c0-16.799 2.54-31.058 7.61-42.778 5.08-11.72 12.41-20.705 21.98-26.956 9.57-6.251 20.9-9.376 33.99-9.376v20.803Zm-78.23-20.217h22.85V284h-22.85V129.882Zm212.73 67.976c-.39-10.353-2.83-19.24-7.32-26.663-4.3-7.618-10.26-13.478-17.87-17.58-7.43-4.102-16.22-6.153-26.37-6.153-10.75 0-20.22 2.442-28.42 7.325-8.01 4.883-14.36 11.72-19.05 20.51-4.69 8.79-7.03 19.045-7.03 30.765 0 12.111 2.34 22.756 7.03 31.937 4.88 8.985 11.62 16.017 20.22 21.096 8.59 5.079 18.36 7.618 29.3 7.618 19.53 0 35.45-6.641 47.76-19.924l12.6 12.599c-7.43 8.009-16.41 14.259-26.96 18.752-10.55 4.297-22.17 6.446-34.87 6.446-15.23 0-28.71-3.223-40.43-9.669-11.53-6.641-20.51-15.822-26.96-27.542-6.44-11.72-9.67-25.198-9.67-40.434 0-15.236 3.23-28.616 9.67-40.141 6.45-11.72 15.43-20.803 26.96-27.249 11.72-6.641 25-10.06 39.85-10.255 16.6 0 30.37 3.614 41.31 10.841 10.94 7.032 18.95 16.994 24.03 29.886 5.27 12.697 7.42 27.64 6.44 44.829h-130.38v-16.994h110.16Z" />
  </svg>
);

export default async function AuthLayout({ children }: { children: ReactNode }) {
  // For auth pages, redirect if already signed in
  const { userId } = await auth();
  if (userId != null) {
    // Special case handling for SSO callback is now in the component itself
    redirect(`${process.env.NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_REDIRECT_URL}`);
  }

  // Render children directly with the styling that was previously in the wrapper
  return (
    <div className="grid min-h-screen bg-white lg:grid-cols-2">
      <div className="flex flex-col py-10 md:p-6 lg:col-span-1">
        <div className="flex justify-center gap-2 md:justify-start">
          <Link href="/" className="flex items-center gap-2 font-medium">
            <ElevaCareLogo className="h-7 w-auto text-primary" />
          </Link>
        </div>
        <div className="flex flex-1 items-center justify-center">
          <div className="w-full">{children}</div>
        </div>
      </div>
      <div className="relative hidden bg-muted lg:col-span-1 lg:block">
        <Image
          src="/img/Pregnant-Woman-Flowers.jpg"
          alt="Image"
          width={1280}
          height={854}
          className="absolute inset-0 h-full w-full object-cover dark:brightness-[0.2] dark:grayscale"
        />
      </div>
    </div>
  );
}
